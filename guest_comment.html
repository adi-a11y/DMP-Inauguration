<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Guest Inauguration Comment</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <section class="hide" id="mainscreen">
      <div class="swiper">
        <div class="swiper-wrapper">
          <div class="swiper-slide">
            <div class="gradient"></div>
            <div class="form-container">
              <form class="form-content " id="guessCommentID">
                <div class="flex-container">
                <div class="form-group textinaugrh">
                  <h1 class="head">Hello,</h1>
                  <h1 class="head" id="nameid"></h1>
                  <label for="inaugurationComment">Please inaugrate the event with your comments</label>
                  <br />
             

              <textarea   
                id="inaugurationComment"
              name="inaugurationComment"
              placeholder="Inauguration Comment"  rows="4" cols="50"></textarea>
              <div id="charCount" class="counter">0/150 characters</div>
                  <!-- <input
                    type="text"
                    id="inaugurationComment"
                    name="inaugurationComment"
                    placeholder="Inauguration Comment"
                    required
                  /> -->
                </div>
                
                <div class="inaugbtn">
         
                  <button
                    type="button"
                    class="gradient-button"
                    onclick="guestComment()"
                  >
                    Inaugurate the Event
                  </button>
          
              </div>
            </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>
    <div class="successscreen" id="successscreen">
      <div class="container">
        <div class="diya">
          <div class="diya__base base">
            <div class="base__part base__part--bottom">
              <div class="base__decoration base__decoration--left"></div>
              <div class="base__decoration base__decoration--right"></div>
            </div>
            <div class="base__part base__part--top"></div>
          </div>
          <div class="diya__flame flame"  id="flame2">
            <div class="flame__shadow flame__shadow--big"></div>
            <div class="flame__shadow flame__shadow--sm1"></div>
            <div class="flame__shadow flame__shadow--sm2"></div>
            <div class="flame__shadow flame__shadow--sm3"></div>
            <div class="flame__fire flame__fire--outer"></div>
            <div class="flame__fire flame__fire--inner"></div>
          </div>
          <div class="diya__shadow shadow">
            <div class="shadow__flame"></div>
            <div class="shadow__diya"></div>
          </div>
        </div>
    </div>
      <h2 class="headsuccess">Successful</h2>
      <a href="https://dhiway.github.io/DMP-Inauguration/" target="_blank">
        <h1 class="liveclick" id="watch">Watch the live inauguration screen ----></h1>
    </a>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <script>
    const textarea = document.getElementById('inaugurationComment');
    const charCountDiv = document.getElementById('charCount');
    const maxChars = 150;
    textarea.addEventListener('input', function() {
        const charCount = this.value.length;
        if (charCount > maxChars) {
            this.value = this.value.substring(0, maxChars);
        }
        charCountDiv.innerText = `${this.value.length}/${maxChars} characters`;
    })

    function getQueryName() {
            const hashdata = window.location.hash.substring(1)
            const params = new URLSearchParams(hashdata)
            const name = params.get('name');
            const namediv = document.getElementById("nameid");
            namediv.innerText = name;
        }
        window.onload = getQueryName;

      function getHashParams() {
        const hash = window.location.hash.substring(1)
        const params = new URLSearchParams(hash)
        return {
          email: params.get("email"),
          identifier: params.get("identifier"),
          document_hash: params.get("document_hash"),
          name: params.get("name"),
        }
      }

      function guestComment() {
        const hashParams = getHashParams()
        console.log(hashParams)
        const comment = document.getElementById("inaugurationComment").value

        console.log(comment)
        console.log("Email:", hashParams.email)
        console.log("Identifier:", hashParams.identifier)
        console.log("Document Hash:", hashParams.document_hash)
        console.log("Name:", hashParams.name)
        console.log("Input Field:", comment)
        

        const data = {
          email: hashParams.email,
          identifier: hashParams.identifier,
          document_hash: hashParams.document_hash,
          comment: comment,
        }
        console.log("here data sent",data);

        fetch("http://localhost:3002/api/v1/dmp/witness", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        })
          .then((response) => {
            console.log("here",response);
            // if (!response.ok) {
            //   throw new Error("Network response was not ok")
            // }
            alert("Inaugrated successfully!")
            const mainscreen= document.getElementById("mainscreen");
            const successscreen = document.getElementById("successscreen");
            if (successscreen.classList.contains("hidden")) {
              successscreen.classList.remove("hidden");
              mainscreen.classList.add("hidden");
              }
            // form.reset() // Reset the form after successful submission
          })
          .catch((error) => {
            console.error(
              "There was a problem with your fetch operation:",
              error
            )
          })
      }
    </script>
  </body>
</html>
